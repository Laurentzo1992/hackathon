<section id="accueil" class="hero">
    <div class="hero-content">
        <h1>Hackathon ONEA 2025</h1>
        <p>Innover pour l'eau et l'assainissement</p>
        
        <div class="countdown">
            <!-- Message dynamique -->
            <h3 class="countdown-message">‚è≥ Les inscriptions s'ouvrent bient√¥t...</h3>

            <!-- Timer -->
            <div class="countdown-timer">
                <div class="countdown-item">
                    <span class="countdown-number" id="days">00</span>
                    <span class="countdown-label">Jours</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="hours">00</span>
                    <span class="countdown-label">Heures</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="minutes">00</span>
                    <span class="countdown-label">Minutes</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-number" id="seconds">00</span>
                    <span class="countdown-label">Secondes</span>
                </div>
            </div>

            <!-- Barre de progression -->
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>
        </div>

        <a href="#inscription" class="btn-primary">S'inscrire maintenant</a>
    </div>
</section>


   <script>
        let hackathonStartDate = null;
        let hackathonEndDate = null;

        // Charger les dates depuis l‚ÄôAPI Django
        fetch("/api/hackathon/")
            .then(response => response.json())
            .then(data => {
                if (!data.error) {
                    hackathonStartDate = new Date(data.dateOuverture).getTime();
                    hackathonEndDate = new Date(data.dateFermeture).getTime();

                    // Lancer le compte √† rebours
                    updateCountdown();
                    setInterval(updateCountdown, 1000);
                } else {
                    console.error(data.error);
                    document.querySelector('.countdown').innerHTML =
                        '<h3>‚ö†Ô∏è Impossible de charger les informations du hackathon.</h3>';
                }
            })
            .catch(error => {
                console.error("Erreur AJAX :", error);
                document.querySelector('.countdown').innerHTML =
                    '<h3>‚ö†Ô∏è Erreur de connexion au serveur.</h3>';
            });

        function updateCountdown() {
            if (!hackathonStartDate || !hackathonEndDate) return; // attendre AJAX

            const now = new Date().getTime();
            let distance, message;

            if (now < hackathonStartDate) {
                // Avant ouverture
                distance = hackathonStartDate - now;
                message = "‚è≥ Les inscriptions s'ouvrent bient√¥t... :";
                document.getElementById('progress-bar').style.width = "0%";

            } else if (now >= hackathonStartDate && now <= hackathonEndDate) {
                // P√©riode ouverte
                distance = hackathonEndDate - now;
                message = "üöÄ Inscriptions ouvertes ! Temps restant avant fermeture :";

                const totalDuration = hackathonEndDate - hackathonStartDate;
                const elapsed = now - hackathonStartDate;
                const progressPercent = (elapsed / totalDuration) * 100;
                document.getElementById('progress-bar').style.width = progressPercent + "%";

            } else {
                // Apr√®s fermeture
                document.querySelector('.countdown').innerHTML =
                    '<h3>‚úÖ Les inscriptions sont termin√©es. Merci √† tous les participants !</h3>';
                return;
            }

            // Conversion en jours / heures / minutes / secondes
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Mise √† jour du DOM
            document.querySelector('.countdown-message').textContent = message;
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
    </script>
